<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RB Taxi â€“ VÃ½poÄet smÄ›ny</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-512x512.png" />
  <meta name="theme-color" content="#FFCC00" />
  <style>
    input, select, button, textarea {
      font-family: inherit;
      font-size: 100%;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    
      background: linear-gradient(to right, #ffcc00, #ffee55);
      color: #000;
      font-weight: bold;
      border-radius: 6px;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }
    
    body { font-family: sans-serif; margin: 0; background: #fff; color: #111; }
    header {
      background: linear-gradient(to right, #ffcc00, #ffee88); padding: 1rem; display: flex; align-items: center; gap: 1rem; }
    header img { width: 50px; height: 50px; }
    .container {
  box-sizing: border-box;
  max-width: 95vw; max-width: 600px; margin: 2rem auto; padding: 1rem;  overflow-x: auto;}
    h1, h2 { margin: 1rem 0 0.5rem; }
    label { display: block; margin-top: 0.5rem; }
    input, select { width: 100%; padding: 0.5rem; margin-top: 0.2rem;  box-sizing: border-box; width: 100%;
      height: 42px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      appearance: none;
      -webkit-appearance: none;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      transition: box-shadow 0.2s ease-in-out;
    }
    button { padding: 0.7rem 1rem; background: #111; color: #fff; border: none; margin-top: 1rem; width: 100%;  box-sizing: border-box; width: 100%;
      background: linear-gradient(to right, #ffcc00, #ffee55);
      color: #000;
      font-weight: bold;
      border-radius: 6px;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }
    .output, .history { background: #f4f4f4; padding: 1rem; margin-top: 2rem; border-radius: 10px; }
    .red { color: tomato; } .green { color: green; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; font-size: 0.9rem; }
    .actions button { background: #FFCC00; color: #000; margin-top: 0;  box-sizing: border-box; width: 100%;
      background: linear-gradient(to right, #ffcc00, #ffee55);
      color: #000;
      font-weight: bold;
      border-radius: 6px;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }
  
    button:hover {
      transform: scale(1.02);
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }

    .output {
  opacity: 1 !important;

      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .output.visible {
  opacity: 1;

      opacity: 1;
      transform: translateY(0);
    }
    
    .section {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 2px solid #f0f0f0;
      transition: all 0.3s ease;
    }
    .section:hover {
      background-color: #fffef5;
    }

</style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo" />
    <h1>RB Taxi â€“ SmÄ›na</h1>
  </header>
  <div class="container">
  <div style="background:#fffbe6; padding: 1rem; border-radius: 10px; box-shadow: 0 0 4px rgba(0,0,0,0.1);">
    <form id="driverForm">
      <h2>Å˜idiÄ a smÄ›na</h2>
      <label>ğŸ‘¤ JmÃ©no Å™idiÄe:
        <input type="text" id="driverName" placeholder="Zadej svÃ© jmÃ©no" required />
          <option value="Petr">Petr</option>
          <option value="Jana">Jana</option>
          <option value="Karel">Karel</option>
        </select>
      </label>
      <label>ğŸ•˜ Typ smÄ›ny:
        <select id="shiftType">
          <option value="den">DennÃ­</option>
          <option value="noc">NoÄnÃ­</option>
          <option value="1/2">1/2 smÄ›na</option>
        </select>
      </label>
      <label>ğŸš— Celkem km: <input type="number" id="km" required /></label>
      <label>ğŸ’µ CelkovÃ¡ trÅ¾ba (KÄ): <input type="number" id="trzba" required /></label>
      <label>ğŸ PÅ™Ã­stavnÃ© (KÄ): <input type="number" id="pristavne" required /></label>
      <label>â›½ Palivo (KÄ): <input type="number" id="palivo" required /></label>
      <label>ğŸ§¼ MytÃ­ (KÄ): <input type="number" id="myti" required /></label>
      <label>ğŸ’³ Kartou (KÄ): <input type="number" id="karta" required /></label>
      <label>ğŸ“„ Fakturou (KÄ): <input type="number" id="faktura" required /></label>
      <label>ğŸ’¬ JinÃ© platby (KÄ): <input type="number" id="jine" required /></label>
      <button type="button" onclick="calculate()">ğŸ’¡ SpoÄÃ­tat a uloÅ¾it</button>
    </form>

    </div>
<div class="section output" id="output"></div>

    <div class="section history">
      <h2>ğŸ“‹ Historie smÄ›n</h2>
      <div id="historyTable"></div>
<button type="button" onclick="clearMyHistory()">ğŸ—‘ï¸ Smazat moji historii</button>
    </div>
  </div>

  <script>
    function saveToHistory(data) {
      const history = JSON.parse(localStorage.getItem("shiftHistory") || "[]");
      history.push(data);
      localStorage.setItem("shiftHistory", JSON.stringify(history));
      renderHistory();
    }

    
    function renderHistory() {
      const currentDriver = document.getElementById("driverName").value.trim();
      if (!currentDriver) {
        document.getElementById("historyTable").innerHTML = "<p>Zadej nejprve svÃ© jmÃ©no pro zobrazenÃ­ historie.</p>";
        return;
      }
      const history = JSON.parse(localStorage.getItem("shiftHistory") || "[]");
      const filtered = history.filter(r => r.driver === currentDriver);
      if (filtered.length === 0) {
        document.getElementById("historyTable").innerHTML = "<p>Å½Ã¡dnÃ© zÃ¡znamy pro Å™idiÄe " + currentDriver + ".</p>";
        return;
      }
      let html = "<table><thead><tr><th>Datum</th><th>Å˜idiÄ</th><th>SmÄ›na</th><th>Km</th><th>VÃ½plata</th><th></th></tr></thead><tbody>";
      filtered.forEach((row, i) => {
        html += `<tr>
          <td>${row.date}</td>
          <td>${row.driver}</td>
          <td>${row.shift}</td>
          <td>${row.km}</td>
          <td>${row.vyplata} KÄ</td>
          <td class="actions"><button onclick="exportRow(${i})">ğŸ“¤ Export</button></td>
        </tr>`;
      });
      html += "</tbody></table>";
      document.getElementById("historyTable").innerHTML = html;
    }



    function clearMyHistory() {
      const currentDriver = document.getElementById("driverName").value.trim();
      if (!currentDriver) {
        alert("Zadej nejprve svÃ© jmÃ©no.");
        return;
      }
      let history = JSON.parse(localStorage.getItem("shiftHistory") || "[]");
      history = history.filter(r => r.driver !== currentDriver);
      localStorage.setItem("shiftHistory", JSON.stringify(history));
      renderHistory();
    }



    function calculate() {
      const now = new Date();
      const dateStr = now.toLocaleString("cs-CZ");

      const driver = document.getElementById('driverName').value;
      const shift = document.getElementById('shiftType').value;
      const km = parseFloat(document.getElementById('km').value);
      const trzba = parseFloat(document.getElementById('trzba').value);
      const pristavne = parseFloat(document.getElementById('pristavne').value);
      const palivo = parseFloat(document.getElementById('palivo').value);
      const myti = parseFloat(document.getElementById('myti').value);
      const karta = parseFloat(document.getElementById('karta').value);
      const faktura = parseFloat(document.getElementById('faktura').value);
      const jine = parseFloat(document.getElementById('jine').value);

      if (!km || !trzba || isNaN(km) || isNaN(trzba)) {
        alert("Zadej poÄet km a trÅ¾bu!");
        return;
      }

      const trzbaBezPristavneho = trzba - pristavne;
      const vyplata = shift === '1/2'
        ? Math.max(0.30 * trzbaBezPristavneho, 500)
        : Math.max(0.30 * trzbaBezPristavneho, 1000);
      const odevzdava = trzba - vyplata - karta - faktura - jine - palivo - myti;
      const nakladKm = km * 15;
      const doplatek = nakladKm > trzba ? nakladKm - trzba : 0;
      const cenaNaKm = palivo / km;
      const kmColor = cenaNaKm > 2.8 ? 'red' : 'green';

      let output = `
        <p>ğŸ“… <strong>Datum:</strong> ${dateStr}</p>
        <p>ğŸ‘¤ <strong>Å˜idiÄ:</strong> ${driver}</p>
        <p>ğŸ’¸ <strong>VÃ½plata:</strong> ${vyplata.toFixed(2)} KÄ</p>
        <p>ğŸ’° <strong>K odevzdÃ¡nÃ­:</strong> ${odevzdava.toFixed(2)} KÄ</p>
        <p>â›½ <strong>Palivo/km:</strong> <span class="${kmColor}">${cenaNaKm.toFixed(2)} KÄ</span></p>
      `;
      if (doplatek > 0) {
        output += `<p class="red">âš ï¸ TrÅ¾ba nepokrÃ½vÃ¡ nÃ¡klady â€“ doplatek: ${doplatek.toFixed(2)} KÄ</p>`;
      }

      const out = document.getElementById("output"); out.innerHTML = output; out.classList.add("visible");

      document.getElementById("output").classList.remove("visible");
      const shiftData = {
        date: dateStr,
        driver, shift, km,
        vyplata: vyplata.toFixed(2),
        odevzdava: odevzdava.toFixed(2)
      };
      const history = JSON.parse(localStorage.getItem("shiftHistory") || "[]");
      history.push(shiftData);
      localStorage.setItem("shiftHistory", JSON.stringify(history));
      renderHistory();
    }


window.onload = function() { loadDrivers(); renderHistory(); };
  </script>
</body>
</html>