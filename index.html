<!DOCTYPE html>

<html lang="cs">
<head><meta content="#FFD700" name="theme-color"/><meta content="RB Taxi" name="apple-mobile-web-app-title"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="yes" name="apple-mobile-web-app-capable"/><link href="icon-512x512.png" rel="apple-touch-icon"/><link href="favicon.ico" rel="icon" type="image/x-icon"/><meta content="#FFD700" name="theme-color"/><meta content="RB Taxi" name="apple-mobile-web-app-title"/><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/><meta content="yes" name="apple-mobile-web-app-capable"/><link href="icons/icon-512x512.png" rel="apple-touch-icon"/>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>RB Taxi – Výpočet směny</title>
<link href="manifest.json" rel="manifest"/>
<link href="icons/icon-512x512.png" rel="apple-touch-icon"/>
<meta content="#FFCC00" name="theme-color"/>
<style>
    input, select, button, textarea {
      font-family: inherit;
      font-size: 100%;
    }

    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    
      background: linear-gradient(to right, #ffcc00, #ffee55);
      color: #000;
      font-weight: bold;
      border-radius: 6px;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }

    input[type=number] {
      -moz-appearance: textfield;
    }
    
    body { font-family: sans-serif; margin: 0; background: #fff; color: #111; }
    header {
      background: linear-gradient(to right, #ffcc00, #ffee88); padding: 1rem; display: flex; align-items: center; gap: 1rem; }
    header img { width: 50px; height: 50px; }
    .container {
  box-sizing: border-box;
  max-width: 95vw; max-width: 600px; margin: 2rem auto; padding: 1rem;  overflow-x: auto;}
    h1, h2 { margin: 1rem 0 0.5rem; }
    label { display: block; margin-top: 0.5rem; }
    input, select { width: 100%; padding: 0.5rem; margin-top: 0.2rem;  box-sizing: border-box; width: 100%;
      height: 42px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
      appearance: none;
      -webkit-appearance: none;
      box-shadow: 0 1px 2px rgba(0,0,0,0.05);
      transition: box-shadow 0.2s ease-in-out;
    }
    button { padding: 0.7rem 1rem; background: #111; color: #fff; border: none; margin-top: 1rem; width: 100%;  box-sizing: border-box; width: 100%;
      background: linear-gradient(to right, #ffcc00, #ffee55);
      color: #000;
      font-weight: bold;
      border-radius: 6px;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }
    .output, .history { background: #f4f4f4; padding: 1rem; margin-top: 2rem; border-radius: 10px; }
    .red { color: tomato; } .green { color: green; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 0.5rem; font-size: 0.9rem; }
    .actions button { background: #FFCC00; color: #000; margin-top: 0;  box-sizing: border-box; width: 100%;
      background: linear-gradient(to right, #ffcc00, #ffee55);
      color: #000;
      font-weight: bold;
      border-radius: 6px;
      transition: transform 0.15s ease, box-shadow 0.2s ease;
    }
  
    button:hover {
      transform: scale(1.02);
      box-shadow: 0 3px 6px rgba(0,0,0,0.1);
    }

    .output {
  opacity: 1 !important;

      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.4s ease, transform 0.4s ease;
    }

    .output.visible {
  opacity: 1;

      opacity: 1;
      transform: translateY(0);
    }
    
    .section {
      margin-top: 2rem;
      padding-top: 2rem;
      border-top: 2px solid #f0f0f0;
      transition: all 0.3s ease;
    }
    .section:hover {
      background-color: #fffef5;
    }


    .tabs {
      display: flex;
      justify-content: space-around;
      margin-top: 1rem;
      border-bottom: 2px solid #ddd;
    }
    .tab {
      padding: 0.7rem 1rem;
      cursor: pointer;
      background: #f9f9f9;
      border-top-left-radius: 6px;
      border-top-right-radius: 6px;
      border: 1px solid #ddd;
      border-bottom: none;
      font-weight: bold;
    }
    .tab.active {
      background: #fffcc9;
      color: #000;
    }
    .section {
      display: none;
      border: 1px solid #ddd;
      padding: 1rem;
      border-radius: 0 0 10px 10px;
      margin-top: -1px;
    }
    .section.active {
      display: block;
    }
    .section-header {
      background: #fffcc9;
      padding: 0.5rem;
      font-weight: bold;
      border-bottom: 1px solid #ccc;
      margin: -1rem -1rem 1rem -1rem;
      border-radius: 8px 8px 0 0;
    }


img[src*='icon'], link[rel*='icon'] { background: transparent !important; }
    header {
        background-color: #1a1a1a !important;
        background-image: none !important;
        color: white !important;
    }
    </style>
</head>
<body>
<header style="background-color: #1a1a1a; padding: 10px; display: flex; align-items: center;"><img src="logo-header.png" style="height: 60px; max-width: 220px; margin-right: 12px; object-fit: contain;"/><span style="color: white; font-size: 16px; font-weight: 500;">RB Taxi – Směna</span></header>
<div class="container">
<div class="tabs">
<div class="tab active" onclick="switchTab('form')">📝 Formulář</div>
<div class="tab" onclick="switchTab('vypocet')">📊 Výpočet</div>
<div class="tab" onclick="switchTab('historie')">📋 Historie</div>
</div>
<div style="background:#fffbe6; padding: 1rem; border-radius: 10px; box-shadow: 0 0 4px rgba(0,0,0,0.1);">
<div class="section active" id="form"><div class="section-header">📝 Formulář směny</div><form id="driverForm">
<h2>Řidič a směna</h2>
<label>👤 Jméno řidiče:
        <input id="driverName" placeholder="Zadej své jméno" required="" type="text"/>
<option value="Petr">Petr</option>
<option value="Jana">Jana</option>
<option value="Karel">Karel</option>
</label>
<label>🕘 Typ směny:
        <select id="shiftType">
<option value="den">Denní</option>
<option value="noc">Noční</option>
<option value="1/2">1/2 směna</option>
</select>
</label>
<label>🚗 Celkem km: <input id="km" required="" type="number"/></label>
<label>💵 Celková tržba (Kč): <input id="trzba" required="" type="number"/></label>
<label>🏁 Přístavné (Kč): <input id="pristavne" required="" type="number"/></label>
<label>⛽ Palivo (Kč): <input id="palivo" required="" type="number"/></label>
<label>🧼 Mytí (Kč): <input id="myti" required="" type="number"/></label>
<label>💳 Kartou (Kč): <input id="karta" required="" type="number"/></label>
<label>📄 Fakturou (Kč): <input id="faktura" required="" type="number"/></label>
<label>💬 Jiné platby (Kč): <input id="jine" required="" type="number"/></label>
<button onclick="calculate()" type="button">💡 Spočítat a uložit</button>
</form>
</div>
<div class="section" id="vypocet"><div class="section-header">📊 Výpočet</div><div class="output" id="output"></div>
<div class="section" id="historie"><input id="nameFilter" oninput="renderHistory()" placeholder="Filtrovat podle jména" type="text"/><input id="dateFilter" onchange="renderHistory()" type="date"/><div class="section-header">📋 Historie směn</div><div class="history">
<h2>📋 Historie směn</h2>
<div id="historyTable"></div>
<button onclick="clearMyHistory()" type="button">🗑️ Smazat moji historii</button>
</div>
<button onclick="downloadCSV()" type="button">⬇️ Stáhnout CSV</button></div>
</div></div></div><script>
function switchTab(id) {
  document.querySelectorAll(".tab").forEach(tab => tab.classList.remove("active"));
  document.querySelectorAll(".section").forEach(sec => {
    sec.classList.remove("active");
    if (sec.id === id) sec.classList.add("active");
  });
}

function calculate() {
  const name = document.getElementById("driverName").value;
  const shift = document.getElementById("shiftType").value;
  const km = parseFloat(document.getElementById("km").value) || 0;
  const trzba = parseFloat(document.getElementById("trzba").value) || 0;
  const pristavne = parseFloat(document.getElementById("pristavne").value) || 0;
  const palivo = parseFloat(document.getElementById("palivo").value) || 0;
  const myti = parseFloat(document.getElementById("myti").value) || 0;
  const karta = parseFloat(document.getElementById("karta").value) || 0;
  const faktura = parseFloat(document.getElementById("faktura").value) || 0;
  const jine = parseFloat(document.getElementById("jine").value) || 0;

  const vyplata = Math.max(1000, trzba * 0.3);
  const kOdevzdani = trzba - vyplata - palivo;
  const normaTrzba = km * 15;
  const prumerNaKm = palivo / (km || 1);

  const trzbaOK = trzba >= normaTrzba;
  const doplatek = Math.max(0, normaTrzba - trzba);

  const shiftData = {
    date: new Date().toISOString(),
    driver: name,
    shift: shift,
    km,
    trzba,
    pristavne,
    palivo,
    myti,
    karta,
    faktura,
    jine,
    vyplata,
    kOdevzdani,
    prumerNaKm,
    trzbaOK,
    doplatek
  };

  saveToHistory(shiftData);
  renderHistory();

  const trzbaInfo = trzbaOK
    ? '<p style="color:green;"><strong>Tržba vs norma:</strong> OK</p>'
    : `<p style="color:red;"><strong>Doplatek řidiče:</strong> ${doplatek.toFixed(2)} Kč</p>`;

  const outputHTML = `
    <div id="printable">
      <p><strong>Řidič:</strong> ${name}</p>
      <p><strong>Směna:</strong> ${shift}</p>
      <p><strong>Najeté km:</strong> ${km}</p>
      <p><strong>Tržba:</strong> ${trzba.toFixed(2)} Kč</p>
      ${trzbaInfo}
      <p><strong>Průměr na km:</strong> ${prumerNaKm.toFixed(2)} Kč</p>
      <p><strong>Palivo:</strong> ${palivo.toFixed(2)} Kč</p>
      <p><strong>Výplata řidiče:</strong> ${vyplata.toFixed(2)} Kč</p>
      <p><strong>K odevzdání:</strong> ${kOdevzdani.toFixed(2)} Kč</p>
      <button onclick="window.print()">🖨️ Vytisknout protokol</button>
    </div>
  `;
  document.getElementById("output").innerHTML = outputHTML;
  switchTab('vypocet');
  document.getElementById("driverForm").reset();
}

function saveToHistory(data) {
  const history = JSON.parse(localStorage.getItem("shifts") || "[]");
  history.push(data);
  localStorage.setItem("shifts", JSON.stringify(history));
}

function renderHistory() {
  const history = JSON.parse(localStorage.getItem("shifts") || "[]");
  const container = document.getElementById("historyTable");
  if (!container) return;
  if (history.length === 0) {
    container.innerHTML = "<p>Žádná data</p>";
    return;
  }
  let html = "<table><thead><tr><th>Datum</th><th>Řidič</th><th>Směna</th><th>Tržba</th><th>Km</th><th>Palivo</th></tr></thead><tbody>";
  history.forEach(d => {
    html += `<tr><td>${d.date.substring(0,16).replace('T',' ')}</td><td>${d.driver}</td><td>${d.shift}</td><td>${d.trzba} Kč</td><td>${d.km}</td><td>${d.palivo} Kč</td></tr>`;
  });
  html += "</tbody></table>";
  container.innerHTML = html;
}

window.onload = renderHistory;
</script></body>
</html>